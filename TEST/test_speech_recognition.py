import os
import speech_recognition as srt
import moviepy.editor as mp
import librosa
import numpy as np
import soundfile as sf

# clip = mp.VideoFileClip("sample_audio/test.mp4")
clip = mp.AudioFileClip("sample_audio/temp.ogg")
clip.write_audiofile("sample_audio/test.wav",codec='pcm_s16le')

audio_dir = r'sample_audio'
out_dir = r'sample_audio'
audio_file = os.path.join(audio_dir, 'test.wav')
wave, sr = librosa.load(audio_file, sr=None)  

segment_dur_secs = 5
segment_length = sr * segment_dur_secs

num_sections = int(np.ceil(len(wave) / segment_length))
split = []

for i in range(num_sections):
    t = wave[i * segment_length: (i + 1) * segment_length]
    split.append(t)

for i in range(num_sections):
    recording_name = os.path.basename(audio_file[:-4])
    out_file = f"{recording_name}_{str(i)}.wav"
    sf.write(os.path.join(out_dir, out_file), split[i], sr)

recognizer = srt.Recognizer()

res = ""
for i in range(0, num_sections):
    with srt.AudioFile(f"sample_audio/test_{str(i)}.wav") as source:
        audio_data = recognizer.record(source)
        text = recognizer.recognize_google(audio_data, language = "es-MX")
        res += text
        print(i, text)
# print(res) 

# import base64
# import re

# def decode_base64(data, altchars='+/'):
#     data = re.sub('[^a-zA-Z0-9%s]+' % altchars, '', data)  # normalize
#     missing_padding = len(data) % 4
#     if missing_padding:
#         data += '='* (4 - missing_padding)
#     return base64.b64decode(data, altchars)
# str1 = "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"
# # str1 += "=" * ((4 - len(str1) % 4) % 4)
# decode_str = decode_base64(str1)
# print(decode_str)